types:
  - use: echo::proto::V
    as:  V

cast:
  - dummy

events:
  - id: send
    send:
      from: dummy
      type: V
      data:
        exact:
          one: vienas
          two: du
          three: trys
  - id: recv
    after:
      - send
    recv:
      to: dummy
      type: V
      data:
        bind: $TRIPLE
  
  - id: bind-triple
    require: reached
    after:
      - recv
    bind:
      dst:
        $PROTOCOL
        $MESSAGE
        $PAYLOAD
      src:
        bind: $TRIPLE
  
  - id: bind-only-payload
    require: reached
    after:
      - recv
    bind:
      dst:
        - $_
        - $_
        - $PAYLOAD
      src:
        bind: $TRIPLE
  
  - id: bind-payload-one
    require: reached
    after:
      - bind-only-payload
    bind:
      dst:
        one: $ONE
      src:
        bind: $PAYLOAD

  - id: bind-payload-two
    require: reached
    after:
      - bind-only-payload
    bind:
      dst:
        two: $TWO
      src:
        bind: $PAYLOAD

  - id: bind-payload-three
    require: reached
    after:
      - bind-only-payload
    bind:
      dst:
        three: $THREE
      src:
        bind: $PAYLOAD

  - id: bind-invalid
    require: unreached
    after:
      - bind-only-payload
    bind:
      dst:
        four: $FOUR
      src:
        bind: $PAYLOAD

  - id: put-it-back
    require: reached
    after:
      - bind-payload-one
      - bind-payload-two
      - bind-payload-three
    bind:
      dst: $PAYLOAD
      src:
        bind:
          one: $ONE
          two: $TWO
          three: $THREE